<h2>Attributes</h2>

<% if can_edit %>
  <%= form_for(@character) do |f| %>
    <%= render 'shared/error_messages', object: f.object %>
    <%= f.fields_for :char_attributes do |f2| %>
      <div class="row">
        <div class="col-md-3">
          <%= f2.label "#{BaseAttribute.find(f2.object.base_attribute_id).name}" %>
        </div>
        <% if f2.object.base_attribute_id != 9 && !f2.object.base_attribute_id.nil? %>
          <div class="col-md-1">
            <%= f2.label :value_base, "Base"%>
          </div>
          <div class="col-md-2">
            <% f2.object.value_base = f2.object.value_base.to_i %>
            <%= f2.number_field :value_base, in: 1..18, step: 1 %>
          </div>
          <div class="col-md-2">
            <%= f2.label :value_modified, "Modified"%>
          </div>
          <div class="col-md-2">
            <%= f2.number_field :value_modified, in: 1..18, step: 1 %>
          </div>
          <div class="col-md-2">
            <% if f2.object.base_attribute_id > 11 %>
              <% char_attribute = CharAttribute.find(f2.object.id) %>
              <%= link_to 'Delete', [char_attribute.character, char_attribute],
                method: :delete,
                data: { confirm: 'Are you sure?' } %>
            <% end %>
          </div>
        <% elsif !f2.object.base_attribute_id.nil? %>
          <div class="col-md-1">
            <%= f2.label :value_base, "Base"%>
          </div>
          <div class="col-md-2">
            <%= f2.number_field :value_base, in: 0..18, step: 0.01%>
          </div>
          <div class="col-md-2">
            <%= f2.label :value_base, "Modified"%>
          </div>
          <div class="col-md-2">
            <%= f2.number_field :value_modified, in: 0..18, step: 0.01 %>
          </div>
          <div class="col-md-2">
          </div>
        <% end %>
      </div>
    <% end %>
    <div class="row">
      <div class="col-md-12">
        <section class="character_form">
          <%= render 'char_attributes/char_attribute_form' %>
        </section>
      </div>
    </div>

    <br>
    <div class="row">
      <div class="col-md-6">
        <%= f.submit "Update Attributes", class: "btn btn-sm btn-default col-md-6 col-md-offset-3" %>
      </div>
      <div class="col-md-6">
        <%= f.submit "Cancel", class: "btn btn-sm btn-default col-md-6" %>
      </div>
    </div>
  <% end %>
<% else %>
  <% @character.char_attributes.each do |char_attribute| %>
    <div class="col-md-4">
      <strong><%= att_name = BaseAttribute.find(char_attribute.base_attribute_id).name %></strong>:
      <% if char_attribute.base_attribute_id == 3 %>
        <% if !char_attribute.value_modified.nil? && char_attribute.value_modified >= char_attribute.value_base %>
          <% @reaction = char_attribute.value_modified %>
        <% else %>
          <% reaction = char_attribute.value_base %>
        <% end %>
      <% end %>
    </div>
    <div class="col-md-4">
      <% if char_attribute.value_base == char_attribute.value_modified || char_attribute.value_modified.nil? %>
        <% if att_name == "Essence" %>
          <%= char_attribute.value_base %>
        <% else %>
          <%= char_attribute.value_base.to_i %><%= "d6 + #{@reaction.to_i}" if char_attribute.base_attribute_id == 11 %>
        <% end %>
      <% else %>
        <%= char_attribute.value_base.to_i %>/<%= char_attribute.value_modified.to_i %>
      <% end %>
    </div>
    <br>
  <% end %>
  <p>
<% end %>
